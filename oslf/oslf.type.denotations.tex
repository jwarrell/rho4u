\section{Denotational semantics}
\subsection{The topos}

First, let's review how subobject classifiers work in a topos. 

Given a category $\mathsf{Th} = 1 \xrightarrow{f} M$, where 1 is terminal, $\mathsf{Th}$ has five morphisms: $\{1, M, f, !, f!\}$, where $!\colon M \to 1$ and $f!\colon M \xrightarrow{!} 1 \xrightarrow{f} M.$

\subsubsection{The subobject classifier: $\Omega$.}

To understand the subobject classifier $\Omega$ in the topos $\hat{\mathsf{Th}} = {\rm Set}^{\mathsf{Th}^{\rm op}}$, let's consider the behavior on objects and morphisms.

\paragraph{Behavior on objects.}

$\Omega(1)$ is the set of sieves on $1$, the set of subsets of morphisms into $1$ that are closed under precomposition with morphisms in $\mathsf{Th}$.
$\{1, !\}= \top$
$\{\} = \bot$
We can't have $1$ without $! = 1!$.  We can't have $!$ without $1 = !f$.

$\Omega(M)$ is the set of sieves on $M$, the set of subsets of morphisms into $M$ that are closed under precomposition with morphisms in $\mathsf{Th}$.
$\{M, f, f!\} = \top$
$\{f, f!\}$
$\{\} = \bot$
We can't have $M$ without $f=Mf$ and $f!=Mf!$.  We can't have $f$ without $f!$.  We can't have $f!$ without $f = f!f$.

\paragraph{Behavior on morphisms.}

$\Omega(f)(S) =$ union of morphisms $g\in\{1, !\}$ such that $fg \in S$
$\begin{array}{rrcl}\Omega(f)\colon & \Omega(M) & \to & \Omega(1) \\ &\{M, f, f!\} & \mapsto & \{1, !\} \\ & \{f, f!\} & \mapsto & \{1, !\} \\ & \{\} & \mapsto & \{\}\end{array}$

$\Omega(!)(S) =$ union of morphisms $g\in\{M, f, f!\}$ such that $!g \in S$
$\begin{array}{rrcl}\Omega(!)\colon & \Omega(1) & \to & \Omega(M) \\ & \{1, !\} & \mapsto & \{M, f, f!\} \\ & \{\} & \mapsto & \{\}\end{array}$

$\Omega(f!)(S) =$ union of morphisms $g\in\{M, f, f!\}$ such that $f!g \in S$
$\begin{array}{rrcl}\Omega(M)\colon & \Omega(M) & \to & \Omega(M) \\ & \{M, f, f!\} & \mapsto & \{M, f, f!\} \\ & \{f, f!\} & \mapsto & \{M, f, f!\} \\ & \{\} & \mapsto & \{\}\end{array}$

Also, obviously, $\Omega$ of an identity morphism is the identity function on the set $S$.

\subsubsection{Logical operations}

\paragraph{Negation.}
In this section, $!$ is redefined temporarily: $\neg\colon\Omega \to \Omega$ is the character of $\bot\colon 1\to \Omega$, where $\bot$ is the character of $!\colon 0 \to 1$.

\begin{remark} The object 0 in the topos
  $\begin{array}{rcl}0:\mathsf{Th}^{\mathsf{op}} &\to& {\rm Set}\\c & \mapsto & \emptyset\end{array}$
\end{remark}

\begin{remark}
The object 1 in the topos
  $\begin{array}{rcl}1:\mathsf{Th}^{\mathsf{op}} &\to& {\rm Set}\\c & \mapsto & 1\end{array}$
\end{remark}

\begin{remark}
The natural transformation $!\colon 0\to 1$
  The natural transformation $!\colon 0\to 1$ assigns to each object the trivial function $!\colon \emptyset \to 1$.
\end{remark}  

\begin{remark}
The character $\bot\colon 1 \to \Omega$ of $!$
  The character $\bot\colon 1 \to \Omega$ of $!$ is a natural transformation that assigns to every object $X$ the function that maps $\bullet \in 1$ to $\bot \in \Omega(X)$.  It has to send $1$ to $\bot$ because if it didn't, the pullback would be $1$, not $0$ as given.
\end{remark}

\begin{remark}
The character $\neg\colon \Omega \to \Omega$ of $\bot$
The character $\neg\colon \Omega \to \Omega$ of $\bot$ is a natural transformation assigning to each object the function that takes $\bot$ to $\top$ and everything else to $\bot$. If anything other than $\bot$ mapped to $\top$, the pullback would be bigger than $1$.
$\begin{array}{cc}1&\begin{array}{rcl}\neg_1\colon\Omega(1)&\to&\Omega(1)\\ \top &\mapsto &\bot\\ \bot &\mapsto & \top\end{array}\\\\ M & \begin{array}{rcl}\neg_M\colon\Omega(M)&\to&\Omega(M)\\\top & \mapsto & \bot \\ \{f,f!\} & \mapsto & \bot \\\bot & \mapsto & \top\end{array}\end{array}$
\end{remark}

\paragraph{Conjunction.}
TBD

\paragraph{Disjunction.}
TBD

\subsection{Once again, but with monoids}

Here we take $\mathsf{Th}$ to be the finite product category generated by
\begin{itemize}
  \item one generating sort $M$
  \item $n+2$ term constructors:
    \begin{itemize}
      \item $n$ generators $g_{i}: 1 \to M$
      \item identity $e: 1 \to M$
      \item multiplication $*: M \times M \to M$
    \end{itemize}
  \item equations for assoc, unit laws
\end{itemize}

%% Ω: Th^op -> Set
%%       c |-> sieves(c)
%% f:c<-c' |-> Ω(f): Ω(c')
%%     -> Ω(c)
%%                   subset of morphisms into c' closed under
%% precomposition |-> union_{g:d->c' in Ω(c')} preimage of g under C(c',
%% f)
%%   with anything in Th

%% Ω(M) = sieves on M
%% = set of subsets of morphisms in Th into M that are closed under precomposition
%% e.g.
%% all morphisms that factor into a head and a tail that is a particular
%% morphism, like a generator or the identity or multiplication or a term
%% context  ... -> 1 -g_i-> M
%% all morphisms that factor into a head and a tail that is in a set of
%% morphisms, like a subset of the generators or a set of term contexts

%% (can't) Ω(M)^k ⊆ Ω(M^k) (can have entangled tuples) (I think)

\subsubsection{Interpretation of the logic of monoids}

In section \ref{oslf:monoidal-logic} we introduced a logic of monoids
naively generated from sets of monoid expressions. Here we show how to
interpret the formulae of that logic via the native type theory
construction, in terms of a recursive specification of the function $\meaningof{\cdot} : \mathcal{L}(M[G]) \to \int \mathsf{sub} \; \mathsf{Y}$, which is factored into $\meaningof{\cdot}_{2} : \mathcal{L}(M[G]) \to (\mathsf{sub} \; \mathsf{Y})(M)$ the result of which is then paired with $M$ to yield an object in $\int \mathsf{sub} \; \mathsf{Y}$. In general the shape of the translation looks like: $\meaningof{\mathsf{\phi}}_2  =  \lambda X.\bigcup_{z \in \meaningof{\mathsf{\phi}}_{n}} X \xrightarrow{!} 1 \xrightarrow{z} M$.

\begin{eqnarray*}
  & collection \; operations & \\
  \meaningof{\mathsf{true}}_{2} & = & \lambda X.\bigcup_{z \in \mathsf{Th}(1,M)} X \xrightarrow{!} 1 \xrightarrow{z} M \\
  \meaningof{\neg \phi}_{2} & = & \meaningof{\mathsf{true}}_{2} \backslash \meaningof{\phi}_{2} \\
  \meaningof{\phi \& \psi}_{2} & = & \meaningof{\phi}_{2} \cap \meaningof{\psi}_{2} \\
  & spatial \; operations & \\
  \meaningof{\mathbf{e}}_{2} & = & \lambda X.\bigcup_{z \in \{\mathsf{e}\}} \{ X \xrightarrow{!} 1 \xrightarrow{e} M \} \\
  \meaningof{\mathbf{g}}_{2} & = & \lambda X.\bigcup_{z \in \{\mathsf{g}\}} \{ X \xrightarrow{!} 1 \xrightarrow{g} M \} \\
  \meaningof{\phi \mathbf{*} \psi}_{2} & = & \lambda X.\bigcup_{ z \in \{ m \in \mathsf{Th}(1,M) : \exists m_{1}, m_{2}.m = m_{1} \mathsf{*} m_{2}, m_{1} \in \meaningof{\phi}_{2}(1), m_{2} \in \meaningof{\psi}_{2}(1) \}} X \xrightarrow{!} 1 \xrightarrow{z} M
\end{eqnarray*}


\subsubsection{Comparison to topos theoretic constructions}
Here are two presheaves, one for $\mathsf{*}$, the other for $\cap$.  Both are
subobjects of the representable on $M$.  To get natural transformations
from $\mathsf{Th}(-, M)$ into $\Omega(-)$, we take the character of the presheaves.

\begin{mathpar}
  X \in \mathsf{Th}^{op} \\
  \mapsto (X, X) \in (\mathsf{Th}^{op})^{2} \;\text{via}\; \Delta:\mathsf{Th}^{op} \to (\mathsf{Th}^{op})^{2} \;\text{in}\; \mathsf{Cat} \\
  \mapsto (\phi'(X), \psi'(X)) \in P(\mathsf{Th}(X,M))^{2} \subseteq \mathsf{Set}^{2} \;\text{via}\; \phi' \;\text{and}\; \psi' \;\text{and the product in}\; \mathsf{Cat} \\
  \mapsto \phi'(X) \times \psi'(X) \subseteq \mathsf{Th}(X,M)^{2} \in \mathsf{Set} \;\text{via the product in}\; \mathsf{Set} \\
  \mapsto \phi'(X) \mathsf{*} \psi'(X) \subseteq \mathsf{Th}(X,M) \in \mathsf{Set} \;\text{via mapping}\; \mathsf{*} \circ - \circ \Delta \;\text{over the set of pairs}\; \\

  \phi'(X) \times \psi'(X) \subseteq \mathsf{Th}(X,M)^{2} \to \phi'(X) \mathsf{*} \psi'(X) \subseteq \mathsf{Th}(X,M) \\
  \text{where}\; \mathsf{*} \circ - \circ \Delta = (f, g) \mapsto \lambda x.f(x) \mathsf{*} g(x) 
\end{mathpar}

\begin{mathpar}
  X \in \mathsf{Th}^{op}
  \mapsto (X, X) \in (\mathsf{Th}^{op})^{2} \;\text{via}\; \Delta:\mathsf{Th}^{op} \to (\mathsf{Th}^{op})^{2} \;\text{in}\; \mathsf{Cat}
\end{mathpar}
Here are two presheaves, one for $\mathsf{*}$, the other for $\cap$.  Both are
subobjects of the representable on M.  To get natural transformations
from $\mathsf{Th}( -, M )$ into $\Omega(-)$, we take the character of the presheaves.

%% ↦ X^2 via Δ in Cat
%% ↦ (φ'(X), ψ'(X)) ∈ P(Th(X, M))² ⊆ Set² via φ' and ψ' and the product in Cat
%% ↦ φ'(X) ∩ ψ'(X) ∈ P(Th(X, M)) ⊆ Set via intersection of subsets

 \begin{mathpar}
   X \in \mathsf{Th}^{op} \\
  \mapsto (X, X) \in (\mathsf{Th}^{op})^{2} \;\text{via}\; \Delta:\mathsf{Th}^{op} \to (\mathsf{Th}^{op})^{2} \;\text{in}\; \mathsf{Cat}
\end{mathpar}

\subsection{The denotations of types and inferences}
In general, the denotation of inference rules will be a natural or dinatural transformation from functors whose source and target are products of copies of the Grothedieck category $\mathsf{NT}$. More specifically, since rules are of the form

\begin{mathpar}
  \inferrule* [lab=Rule]{\Gamma_{1} \vdash P_{1} : \mathbf{U}_{1} : \mathbf{X}_{1} \;\ldots\; \Gamma_{n} \vdash P_{n} : \mathbf{U}_{n} : \mathbf{X}_{n}}{K_{\Gamma}(\Gamma_{1},\ldots,\Gamma_{n}) \vdash K_{P}(P_{1},\ldots,P_{n}) : K_{\mathbf{U}}(\mathbf{U}_{1},\ldots,\mathbf{U}_{n}) : K_{\mathbf{X}}(\mathbf{X}_{1},\ldots,\mathbf{X}_{n})}
\end{mathpar}

then the denotation of such a rule is

$$\begin{array}{l}
  \meaningof{\mathsf{Rule}} : \meaningof{P_{1}} : \meaningof{\Gamma_{1}} \to \meaningof{\mathbf{U}_{1} : \mathbf{X}_{1}} \times \cdots \times \meaningof{P_{n}} : \meaningof{\Gamma_{n}} \to \meaningof{\mathbf{U}_{n} : \mathbf{X}_{n}} \\\Rightarrow\\ \meaningof{K_{P}(P_{1},\ldots,P_{n})} : \meaningof{K_{\Gamma}(\Gamma_{1},\ldots,\Gamma_{n})} \to \meaningof{K_{\mathbf{U}}(\mathbf{U}_{1},\ldots,\mathbf{U}_{n}) : K_{\mathbf{X}}(\mathbf{X}_{1},\ldots,\mathbf{X}_{n})}
\end{array}$$

Note that $P_{i}$ and likewise $\mathbf{U_{i}}$, $\mathbf{X_{i}}$, and
even $\Gamma_{i}$ are effectively meta-variables, rendering the
meaning of any judgment in the hypothesis of an inference rule as the
hom-functor of $\mathsf{NT}$. That is, $\meaningof{P_{i}} : \meaningof{\Gamma_{i}} \to \meaningof{\mathbf{U}_{i} : \mathbf{X}_{i}} = \mathsf{NT}(-_{1},-_{2})$ because barring any further information regarding the value of these meta-variables $\meaningof{P_{i}} : \meaningof{\Gamma_{i}} \to \meaningof{\mathbf{U}_{i} : \mathbf{X}_{i}}$ could be any morphism in $\mathsf{NT}(\meaningof{\Gamma_{i}},\meaningof{\mathbf{U}_{i} : \mathbf{X}_{i}})$; and since neither $\Gamma_{i}$ nor $\mathbf{U}_{i} : \mathbf{X}_{i}$ are specified it could be any morphism in $\mathsf{NT}(-_{1},-_{2})$. Thus, if we let $\mathsf{NT}(-_{1}, -_{2})^n = \Pi_{i}^{n}\mathsf{NT}(-_{1}, -_{2})$ the meaning of an inference rule is a (di-)natural transformation from $\mathsf{NT}(-_{1}, -_{2})^{n} \Rightarrow \mathsf{NT}(-_{1}, -_{2}) \circ k_{1} \times k_{2}$, constructing the consequent of the rule.

Thus, the meaning of the ground of the system will be

$$\begin{array}{rcl}
  \ldb \mathsf{Axiom}\; \epsilon & \Vdash & p : \mathbf{U} : \mathbf {X} \vdash p : \mathbf{U} : \mathbf {X} \rdb \\
  & = & \\
  \meaningof{\mathsf{Axiom}} : \meaningof{\epsilon} & \Rightarrow & \meaningof{p} : \meaningof{p : \mathbf{U : X}} \to \meaningof{\mathbf{U : X}} \\
 & = & \\
  \meaningof{\mathsf{Axiom}} : \mathsf{!} \circ \mathsf{1}_{\mathsf{NT^{op}}} \times \mathsf{1}_{\mathsf{NT}} & \Rightarrow & \mathsf{NT}^{1} \circ \mathsf{1}_{\mathsf{NT^{op}}} \times \mathsf{1}_{\mathsf{NT}} \\
	\bullet \in \, !(\meaningof{\mathbf{U} : \mathbf{X}}, \meaningof{\mathbf{U} : \mathbf{X}}) = \{\bullet \}& \mapsto & 1_{\meaningof{\mathbf{U} : \mathbf{X}}} \in \mathsf{NT}(\meaningof{\mathbf{U} : \mathbf{X}}, \meaningof{\mathbf{U} : \mathbf{X}})
\end{array}$$

Likewise, we calculate

$$\begin{array}{l}
  \meaningof{\Gamma \vdash Q : \mathbf{U} : \mathbf {X} \Vdash \Gamma \vdash \mathsf{Ch}(Q) : \mathbf{\{ Q \}} : \mathbf {X}} \\
  = \\
  \meaningof{\mathsf{Character}} : \meaningof{Q} : \meaningof{\Gamma} \to \meaningof{\mathbf{U} : \mathbf{X}} \Rightarrow \meaningof{\mathsf{Ch}(Q)} : \meaningof{\Gamma} \to \meaningof{\mathbf{\{ Q \}} : \mathbf {X}} \\
	\meaningof{Q}\in \mathsf{NT}(\meaningof{\Gamma}, \meaningof{\mathbf{U} : \mathbf{X}}) \mapsto \meaningof{\mathsf{Ch}(Q)} \in \mathsf{NT}(\meaningof{\Gamma}, {\rm Im}(\meaningof{Q}))
\end{array}$$
where ${\rm Im}(\meaningof{Q})$ denotes the subobject of the representable on $\mathbf{X}$ that assigns to each sort $S$ the set ${\rm Im}(\meaningof{Q}(S)).$  Because each set ${\rm Im}(\meaningof{Q}(S))$ is a subset of $\meaningof{U}(S)$, ${\rm Im}(\meaningof{Q})$ is a subobject of $\meaningof{\mathbf{U} : \mathbf{X}}$, which is in turn a subobject of the representable on $\mathbf{X}$.
%% left off here in discussion of is it the same Q.

$$\begin{array}{l}
  \meaningof{\Gamma \vdash P : \mathbf{U} : \mathbf {X} \;\;\; p : \mathbf{U} : \mathbf {X}, \Delta \vdash Q : \mathbf{V} : \mathbf {Y} \Vdash \Gamma, \Delta \vdash Q \substn{P}{p} : \mathbf{V} : \mathbf {Y}} \\
  = \\
  \meaningof{\mathsf{Composition}} : \langle \meaningof{P}, \meaningof{Q} \rangle \Rightarrow \meaningof{Q\substn{P}{p}} : \meaningof{\Gamma} \times \meaningof{\Delta} \to \meaningof{\mathbf{V} : \mathbf{Y}} \\
  = \\
  \quad \mathsf{NT}(\Gamma,\mathbf{U} : \mathbf {X}) \times \mathsf{NT}(\mathbf{U} : \mathbf {X} \times \Delta, \mathbf{V} : \mathbf {Y}) \Rightarrow \mathsf{NT}(\Gamma \times \Delta, \mathbf{V} : \mathbf {Y})
\end{array}$$

where $\meaningof{P} : \meaningof{\Gamma} \to \meaningof{\mathbf{U} : \mathbf{X}}$ and $ \meaningof{Q} : \meaningof{\mathbf{U} : \mathbf{X}} \times \meaningof{\Delta} \to \meaningof{\mathbf{V} : \mathbf{Y}}$; and the source and target of the denotation are $\mathsf{NT}^{\mathsf{op}} \times \mathsf{NT} \times \mathsf{NT}^{\mathsf{op}} \times \mathsf{NT}^{\mathsf{op}} \times \mathsf{NT} \to \mathsf{Set}$.

$$\begin{array}{l}
  \meaningof{\Gamma \vdash P : \mathbf{U} : \mathbf {P} \;\;\; \Delta \vdash Q : \mathbf{V} : \mathbf {P} \Vdash \Gamma,\Delta \vdash \mathsf{pair}( P,Q ) : \mathbf{U} \otimes \mathbf{V} : \mathbf {P}} \\
  = \\
  \meaningof{\mathsf{Pair}} : \mathsf{NT}(\meaningof{\Gamma},\meaningof{\mathbf{U}:\mathbf{P}}) \times \mathsf{NT}(\meaningof{\Delta},\meaningof{\mathbf{V}:\mathbf{P}}) \Rightarrow \mathsf{NT}(\meaningof{\Gamma} \times \meaningof{\Delta},\mathsf{pair} \circ \meaningof{\mathbf{U}:\mathbf{P}} \times \meaningof{\mathbf{V}:\mathbf{P}}) \\
  = \\
  ??? \\
\end{array}$$


